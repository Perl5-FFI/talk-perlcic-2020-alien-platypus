<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>A Year of Alien and Platypus</title>

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/black.css" id="theme">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
    <style type="text/css">
      strong { color:orange; }
      em { color: yellow; }
      p code { color: cyan; }
      sup { color: yellow; }
    </style>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">

        <section data-markdown>
          <textarea data-template>
            A Year of **Alien** and **Platypus**
          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            **Alien::Build** and **FFI::Platypus** are alternative tooling for
            Perl that fill in the missing parts from *XS* and *ExtUtils::MakeMaker*
          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            In the year since the Perl Conference in Pittsburgh, **Alien::Build**
            and **FFI::Platypus** have had some useful enhacements
          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            **Alien::Build** is a toolkit for making external (non-CPAN/Perl)
            dependencies available to Perl modules
          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            The **Build::Copy**<sup>*</sup> Plugin for Alien::Build for aliens without a build step

            ```perl [1-6|5]
            use alienfile;
            ...
            share {
              start_url "https://github.com/...";
              plugin 'Build::Copy';
            }
            ```

            <small style="margin-left: 60%; margin-top: 50px;"><sup>*</sup>Used by *Alien::wasmtime*
            and *Wasm*</small>

          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            The **Win32::Vcpkg** module and **Probe::Vcpkg** plugin makes it easier to use
            Visual C++ Perl

            ```perl [1-2|2]
            use alienfile;
            plugin 'Probe::Vcpkg' => 'libffi' if 
            ```
          
            <small style="margin-left: 60%; margin-top: 50px;"><sup>*</sup>Used by *Alien::FFI*
            and *FFI::Platypus*</small>
          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            **Vcpkg** is a **cmake** based package management system for Visual C++ with a much
            larger set of packages that what is available to Strawberry Perl
          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            A number of adoptions of older broken *Alien* modules by the folks of *#native*
            on *irc.perl.org* &#127881;
          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            **FFI::Platypus** is an library for writing library bindings for Perl
          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            **FFI::Platypus** is an easier alternative to *XS*
          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            **FFI::C** is an interface to C style nested data structures

            ```perl [1-18|3-7|9-13|15-18]
            use FFI::C;

            package ColorValue {
              FFI::C->struct([
                red => 'uint8', green => 'uint8', blue => 'uint8',
              ]);
            }
 
            package NamedColor {
              FFI::C->struct([
                name  => 'string(22)', value => 'color_value_t',
              ]);
            }

            my $red = NamedColor->new({
              name => "red", 
              value => { red => 255 }
            });
            ```

            <small style="margin-left: 60%; margin-top: 50px;"><sup>*</sup>Used by *NewFangle*
            and *Wasm::Wasmtime*</small>
          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            **FFI::C** supports unions

            ```perl [1-17|3-10|12-13]
            use FFI::C;

            package AnyInt {
              FFI::C->union([
                u32 => 'uint32',
                u64 => 'uint64',
                i32 => 'sint32',
                i64 => 'sint64',
              ]);
            }

            my $ai = AnyInt->new({ u32 => 0xffffffff });
            say $ai->i32;  # print signed
            ```
          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            **FFI::C** makes using enumerated types (*enum*) easier
            
            ```perl [1-14|3-9|11|13-14]
            use FFI::C;

            package Config {
              FFI::C->enum([
                'default',
                'better',
                ['best' => 12],
              ]);
            }

            $ffi->attach( set_config => [ 'config_t' ] );

            set_config( 'better' );   # passes 1
            set_config( 'best'   );   # passes 12
            ```
          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            Platypus now has an interface for **Bundling** code from other
            languages

            ```c [1-36|4-7|9-17|19-23|25-29|31-36]
            #include "ffi_platypus_bundle.h"
            #include "string.h"
             
            typedef struct {
              char *name;
              int value;
            } foo_t;
             
            foo_t*
            foo__new(const char *class_name, const char *name, int value)
            {
              (void)class_name;
              foo_t *self = malloc( sizeof( foo_t ) );
              self->name = strdup(name);
              self->value = value;
              return self;
            }
             
            const char *
            foo__name(foo_t *self)
            {
              return self->name;
            }
             
            int
            foo__value(foo_t *self)
            {
              return self->value;
            }
             
            void
            foo__DESTROY(foo_t *self)
            {
              free(self->name);
              free(self);
            }
            ```

          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            ```perl [1-21|13|15-20]
            package Foo;
            use FFI::Platypus 1.00;

            my $ffi = FFI::Platypus->new( api => 1 );
             
            $ffi->type('object(Foo)' => 'foo_t');
            $ffi->mangler(sub {
              my $name = shift;
              $name =~ s/^/foo__/;
              $name;
            });
             
            $ffi->bundle;
           
            $ffi->attach(
              new => [ 'string', 'string', 'int' ] => 'foo_t',
            );
            $ffi->attach( name =>    [ 'foo_t' ]  => 'string' );
            $ffi->attach( value =>   [ 'foo_t' ]  => 'int'    );
            $ffi->attach( DESTROY => [ 'foo_t' ]  => 'void'   );
            ```

          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            Define constants from C using the bundle interface

            ```c [1-10|8|9]
            #include "ffi_platypus_bundle.h"

            void
            ffi_pl_bundle_constant(
              const char *package,
              ffi_platypus_constant_t *c)
            {
              set_str("FOO",     "BAR");
              set_uint("ANSWER"  42);
            }
          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            Platypus now supports variadic functions

            ```perl [1-9|4-8|9]
            use FFI::Platypus 1.00;

            my $ffi = FFI::Platypus->new( api => 1 );
            my $printf = $ffi->function(
              'printf' => 
              [ 'string'] => 
              [ 'string', 'int', 'float' ]
            );
            $printf->call("%s %d %g\n", "hello", 42, 3.14);
            ```
          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            Platypus now has support for **pass-by-value records**

            ```perl [1-15|14|15]
            use FFI::Platypus 1.00;

            my $ffi = FFI::Platypus->new( api => 1 );

            package Color {
              use FFI::Platypus::Record;
              record_layout_1(qw(
                uint8 red
                uint8 green
                uint8 blue
              ));
            }

            $ffi->attach( set_color_value => [ 'record(Color)' ]);
            $ffi->attach( set_color_ptr   => [ 'record(Color)*' ]);
            ```
          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            Platypus now has support for **custom records**

            ```perl
            use FFI::Platypus 1.00;
            ```
          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            **Pass-by-value records** and **custom recoords** support is essential for
            modern languages like *Go* and *Rust*
          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            * New **FFI::Platypus::Lang::Go** language plugin for *Go*
            * Improved **FFI::Platypus::Lang::Rust** language plugin for *Rust*
          </textarea>
        </section>

        <section data-markdown>
          <textarea data-template>
            Please join us to see what we can accomplish in the next year

            * The *#native* chanel on *irc.perl.org*
            * The *perlwasm* org on GitHub
          </textarea>
        </section>

      </div>
    </div>

    <script src="dist/reveal.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script>
      // More info about initialization & config:
      // - https://revealjs.com/initialization/
      // - https://revealjs.com/config/
      Reveal.initialize({
        hash: true,

        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
      });
    </script>
  </body>
</html>

